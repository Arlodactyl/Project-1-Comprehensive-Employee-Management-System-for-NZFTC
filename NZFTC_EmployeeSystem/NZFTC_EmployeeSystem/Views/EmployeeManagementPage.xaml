<Page x:Class="NZFTC_EmployeeSystem.Views.EmployeeManagementPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:NZFTC_EmployeeSystem.Views"
      mc:Ignorable="d" 
      d:DesignHeight="1600" d:DesignWidth="900"
      Title="Employee Management">

    <Page.Resources>
        <!-- Button Style -->
        <Style x:Key="ActionButton" TargetType="Button">
            <Setter Property="Background" Value="#3498DB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="5"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#2980B9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Toggle Button Style -->
        <Style x:Key="ToggleButton" TargetType="Button" BasedOn="{StaticResource ActionButton}">
            <Setter Property="Background" Value="#F39C12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="5"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#D68910"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Export Button Style -->
        <Style x:Key="ExportButton" TargetType="Button" BasedOn="{StaticResource ActionButton}">
            <Setter Property="Background" Value="#27AE60"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="5"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#229954"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- View Button Style (Blue - matches ActionButton) -->
        <Style x:Key="ViewButton" TargetType="Button" BasedOn="{StaticResource ActionButton}">
            <Setter Property="Background" Value="#3498DB"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="5"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#2980B9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Info Button Style -->
        <Style x:Key="InfoButton" TargetType="Button">
            <Setter Property="Background" Value="#3498DB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Width" Value="30"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="15"
                                BorderThickness="0">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#2980B9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- TextBox Style -->
        <Style x:Key="ModernTextBox" TargetType="TextBox">
            <Setter Property="Height" Value="32"/>
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="BorderBrush" Value="#BDC3C7"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <!-- DatePicker Style -->
        <Style x:Key="ModernDatePicker" TargetType="DatePicker">
            <Setter Property="Height" Value="32"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="BorderBrush" Value="#BDC3C7"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <!-- ComboBox Style -->
        <Style x:Key="ModernComboBox" TargetType="ComboBox">
            <Setter Property="Height" Value="32"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="BorderBrush" Value="#BDC3C7"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#34495E" Padding="20">
            <Grid>
                <TextBlock Text="Employee Management" 
                           FontSize="24" 
                           FontWeight="Bold" 
                           Foreground="White"
                           VerticalAlignment="Center"/>

                <!-- Help Button -->
                <Button Content="i"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Width="35"
                        Height="35"
                        Click="InfoButton_Click"
                        ToolTip="Employee Management Help">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#3498DB"/>
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="FontSize" Value="16"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Cursor" Value="Hand"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="17.5">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#2980B9"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>
            </Grid>
        </Border>

        <!-- Content with Tabs -->
        <TabControl x:Name="MainTabControl" Grid.Row="1" Margin="0">
            <!-- Tab 1: Employees List -->
            <TabItem Header="Employees" FontSize="14">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">

                        <!-- Search and Export Section -->
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Search Box -->
                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                <TextBlock Text="Search:" 
                                           VerticalAlignment="Center"
                                           FontSize="14"
                                           FontWeight="SemiBold"
                                           Margin="0,0,10,0"/>
                                <TextBox x:Name="SearchTextBox"
                                         Width="300"
                                         Style="{StaticResource ModernTextBox}"
                                         TextChanged="SearchTextBox_TextChanged"/>
                            </StackPanel>

                            <!-- Export Button -->
                            <Button Grid.Column="1"
                                    Content="Export to CSV"
                                    Style="{StaticResource ExportButton}"
                                    Click="ExportEmployees_Click"/>
                        </Grid>

                        <!-- Employees List Section -->
                        <TextBlock Text="Current Employees" 
                                   FontSize="18" 
                                   FontWeight="Bold" 
                                   Foreground="#2C3E50"
                                   Margin="0,0,0,5"/>

                        <TextBlock Text="Select an employee and use the action buttons below, or double-click to view options." 
                                   FontSize="12" 
                                   Foreground="#7F8C8D"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>

                        <!-- DataGrid with Double-Click handler -->
                        <DataGrid x:Name="EmployeesGrid"
                                  Height="300"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  SelectionMode="Single"
                                  CanUserAddRows="False"
                                  AlternatingRowBackground="#ECF0F1"
                                  GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column"
                                  Margin="0,0,0,15"
                                  MouseDoubleClick="EmployeesGrid_MouseDoubleClick"
                                  HorizontalScrollBarVisibility="Auto">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="50"/>
                                <DataGridTextColumn Header="Full Name" Binding="{Binding FullName}" Width="150"/>
                                <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="180"/>
                                <DataGridTextColumn Header="Job Title" Binding="{Binding JobTitle}" Width="150"/>
                                <DataGridTextColumn Header="Department" Binding="{Binding Department.Name}" Width="*" MinWidth="120"/>
                                <DataGridCheckBoxColumn Header="Active" Binding="{Binding IsActive}" Width="80"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Employee Action Buttons -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                            <Button Content="View Details" 
                                    Style="{StaticResource ViewButton}"
                                    Click="ViewEmployeeDetails_Click"/>
                            <Button Content="Edit Employee" 
                                    Style="{StaticResource ActionButton}"
                                    Click="EditEmployee_Click"/>
                            <Button Content="View Training" 
                                    Style="{StaticResource ActionButton}"
                                    Click="ViewEmployeeTraining_Click"/>
                        </StackPanel>

                        <!-- Create New Employee Section -->
                        <Border BorderBrush="#BDC3C7" 
                                BorderThickness="1" 
                                Padding="20" 
                                Margin="0,10,0,0"
                                Background="#F8F9FA"
                                CornerRadius="5">
                            <StackPanel>
                                <TextBlock Text="Create New Employee" 
                                           FontSize="18" 
                                           FontWeight="Bold" 
                                           Foreground="#2C3E50"
                                           Margin="0,0,0,15"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="20"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Left Column -->
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="First Name *" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="FirstNameTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,10"/>

                                        <TextBlock Text="Email *" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="EmailTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,10"/>

                                        <TextBlock Text="Job Title" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="JobTitleTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,10"/>

                                        <TextBlock Text="Hire Date" FontSize="12" Margin="0,0,0,3"/>
                                        <DatePicker x:Name="HireDatePicker" Style="{StaticResource ModernDatePicker}" Margin="0,0,0,10"/>

                                        <TextBlock Text="Tax Rate (%) *" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="TaxRateTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,10"/>

                                        <TextBlock Text="Username *" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="UsernameTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,10"/>
                                    </StackPanel>

                                    <!-- Right Column -->
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Last Name *" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="LastNameTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,10"/>

                                        <TextBlock Text="Phone Number" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="PhoneTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,10"/>

                                        <TextBlock Text="Department *" FontSize="12" Margin="0,0,0,3"/>
                                        <ComboBox x:Name="DepartmentComboBox" 
                                                  Style="{StaticResource ModernComboBox}" 
                                                  Margin="0,0,0,10"/>

                                        <TextBlock Text="Salary *" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="SalaryTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,10"/>

                                        <TextBlock Text="Role *" FontSize="12" Margin="0,0,0,3"/>
                                        <ComboBox x:Name="RoleComboBox" Style="{StaticResource ModernComboBox}" Margin="0,0,0,10">
                                            <ComboBoxItem Content="Employee"/>
                                            <ComboBoxItem Content="Admin"/>
                                            <ComboBoxItem Content="Workplace Trainer"/>
                                        </ComboBox>

                                        <TextBlock Text="Password *" FontSize="12" Margin="0,0,0,3"/>
                                        <PasswordBox x:Name="PasswordBox" 
                                                     Height="32" 
                                                     Padding="8,5"
                                                     FontSize="13"
                                                     BorderBrush="#BDC3C7"
                                                     BorderThickness="1"
                                                     Margin="0,0,0,10"/>

                                        <TextBlock Text="Confirm Password *" FontSize="12" Margin="0,0,0,3"/>
                                        <PasswordBox x:Name="ConfirmPasswordBox" 
                                                     Height="32" 
                                                     Padding="8,5"
                                                     FontSize="13"
                                                     BorderBrush="#BDC3C7"
                                                     BorderThickness="1"
                                                     Margin="0,0,0,10"/>
                                    </StackPanel>
                                </Grid>

                                <!-- Create Button -->
                                <Button Content="Create Employee" 
                                        Style="{StaticResource ActionButton}"
                                        HorizontalAlignment="Left"
                                        Margin="0,10,0,0"
                                        Click="CreateEmployee_Click"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Tab 2: Edit Employee (Hidden by default) -->
            <TabItem x:Name="EditEmployeeTab" Header="Edit Employee" FontSize="14" Visibility="Collapsed">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <!-- Edit Employee Section Header -->
                        <TextBlock x:Name="EditEmployeeNameText"
                                   Text="Edit Employee" 
                                   FontSize="18" 
                                   FontWeight="Bold" 
                                   Foreground="#2C3E50"
                                   Margin="0,0,0,15"/>

                        <Border BorderBrush="#BDC3C7" 
                                BorderThickness="1" 
                                Padding="20" 
                                Background="#F8F9FA"
                                CornerRadius="5">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="20"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Left Column -->
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="First Name *" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="EditFirstNameTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,10"/>

                                        <TextBlock Text="Email *" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="EditEmailTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,10"/>

                                        <TextBlock Text="Job Title" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="EditJobTitleTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,10"/>

                                        <TextBlock Text="Hire Date" FontSize="12" Margin="0,0,0,3"/>
                                        <DatePicker x:Name="EditHireDatePicker" Style="{StaticResource ModernDatePicker}" Margin="0,0,0,10"/>

                                        <TextBlock Text="Tax Rate (%) *" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="EditTaxRateTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,10"/>

                                        <TextBlock Text="Sick Leave Balance" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="EditSickLeaveTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,10"/>
                                    </StackPanel>

                                    <!-- Right Column -->
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Last Name *" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="EditLastNameTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,10"/>

                                        <TextBlock Text="Phone Number" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="EditPhoneTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,10"/>

                                        <TextBlock Text="Department *" FontSize="12" Margin="0,0,0,3"/>
                                        <ComboBox x:Name="EditDepartmentComboBox" 
                                                  Style="{StaticResource ModernComboBox}" 
                                                  Margin="0,0,0,10"/>

                                        <TextBlock Text="Salary *" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="EditSalaryTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,10"/>

                                        <TextBlock Text="Annual Leave Balance" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="EditAnnualLeaveTextBox" Style="{StaticResource ModernTextBox}" Margin="0,0,0,10"/>

                                        <TextBlock Text="Active" FontSize="12" Margin="0,0,0,3"/>
                                        <CheckBox x:Name="EditIsActiveCheckBox" 
                                                  Content="Employee is active"
                                                  Margin="0,5,0,10"/>
                                    </StackPanel>
                                </Grid>

                                <!-- Password Change Section (Admin Only) -->
                                <Border x:Name="PasswordChangeBorder"
                                        BorderBrush="#E8DAEF" 
                                        BorderThickness="2" 
                                        Padding="15" 
                                        Background="#FAF7FB"
                                        CornerRadius="5"
                                        Margin="0,15,0,0">
                                    <StackPanel>
                                        <TextBlock Text="Change Employee Password (Admin Only)" 
                                                   FontSize="14" 
                                                   FontWeight="Bold" 
                                                   Foreground="#6C3483"
                                                   Margin="0,0,0,10"/>

                                        <TextBlock Text="Leave blank to keep current password" 
                                                   FontSize="11" 
                                                   Foreground="#7F8C8D"
                                                   FontStyle="Italic"
                                                   Margin="0,0,0,10"/>

                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="20"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="New Password" FontSize="12" Margin="0,0,0,3"/>
                                                <PasswordBox x:Name="EditPasswordBox" 
                                                             Height="32" 
                                                             Padding="8,5"
                                                             FontSize="13"
                                                             BorderBrush="#BDC3C7"
                                                             BorderThickness="1"/>
                                            </StackPanel>

                                            <StackPanel Grid.Column="2">
                                                <TextBlock Text="Confirm New Password" FontSize="12" Margin="0,0,0,3"/>
                                                <PasswordBox x:Name="EditConfirmPasswordBox" 
                                                             Height="32" 
                                                             Padding="8,5"
                                                             FontSize="13"
                                                             BorderBrush="#BDC3C7"
                                                             BorderThickness="1"/>
                                            </StackPanel>
                                        </Grid>
                                    </StackPanel>
                                </Border>

                                <!-- Save and Cancel Buttons -->
                                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                    <Button Content="Save Changes" 
                                            Style="{StaticResource ActionButton}"
                                            Click="SaveEmployeeChanges_Click"/>
                                    <Button Content="Cancel" 
                                            Style="{StaticResource ToggleButton}"
                                            Click="CancelEdit_Click"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Tab 3: Training Records -->
            <TabItem Header="Training Records" FontSize="14" Height="23" VerticalAlignment="Top">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="55*"/>
                        <ColumnDefinition Width="839*"/>
                    </Grid.ColumnDefinitions>
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Grid.ColumnSpan="2">
                        <StackPanel Margin="20">

                            <!-- Training Section Header -->
                            <TextBlock Text="All Employee Training Records" 
                                       FontSize="18" 
                                       FontWeight="Bold" 
                                       Foreground="#2C3E50"
                                       Margin="0,0,0,5"/>

                            <TextBlock Text="View and manage training records for all employees. Use search to filter by employee name or training type." 
                                       FontSize="12" 
                                       Foreground="#7F8C8D"
                                       TextWrapping="Wrap"
                                       Margin="0,0,0,15"/>

                            <!-- Search Box -->
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="Search:" 
                                           Grid.Column="0"
                                           VerticalAlignment="Center"
                                           FontSize="14"
                                           FontWeight="SemiBold"
                                           Margin="0,0,10,0"/>
                                <TextBox x:Name="TrainingSearchTextBox"
                                         Grid.Column="1"
                                         Style="{StaticResource ModernTextBox}"
                                         TextChanged="TrainingSearchTextBox_TextChanged"/>
                                <Button Content="Refresh All"
                                        Grid.Column="2"
                                        Style="{StaticResource ActionButton}"
                                        Click="RefreshTraining_Click"
                                        Margin="10,0,0,0"/>
                            </Grid>

                            <!-- Training Records Grid with Empty State -->
                            <Grid>
                                <!-- Training Records DataGrid -->
                                <DataGrid x:Name="TrainingGrid"
                                          Height="350"
                                          AutoGenerateColumns="False"
                                          IsReadOnly="True"
                                          SelectionMode="Single"
                                          CanUserAddRows="False"
                                          AlternatingRowBackground="#ECF0F1"
                                          GridLinesVisibility="Horizontal"
                                          HeadersVisibility="Column"
                                          Margin="0,0,0,15"
                                          MouseDoubleClick="TrainingGrid_MouseDoubleClick">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="50"/>
                                        <DataGridTextColumn Header="Employee Name" Binding="{Binding Employee.FullName}" Width="180"/>
                                        <DataGridTextColumn Header="Training Type" Binding="{Binding TrainingType}" Width="180"/>
                                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="120"/>
                                        <DataGridTextColumn Header="Completed Date" Binding="{Binding CompletedDate, StringFormat=dd/MM/yyyy}" Width="120"/>
                                        <DataGridTextColumn Header="Signed Off By" Binding="{Binding SignedOffByUser.Username}" Width="140"/>
                                        <DataGridTextColumn Header="Notes" Binding="{Binding Notes}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>

                                <!-- Empty State Message -->
                                <Border x:Name="EmptyTrainingMessage"
                                        Background="#F8F9FA"
                                        BorderBrush="#BDC3C7"
                                        BorderThickness="1"
                                        CornerRadius="5"
                                        Height="350"
                                        Margin="0,0,0,15"
                                        Visibility="Collapsed">
                                    <StackPanel VerticalAlignment="Center" 
                                                HorizontalAlignment="Center"
                                                Margin="20">
                                        <TextBlock x:Name="EmptyMessageText"
                                                   Text="No training records found"
                                                   FontSize="16"
                                                   FontWeight="SemiBold"
                                                   Foreground="#7F8C8D"
                                                   TextAlignment="Center"
                                                   Margin="0,0,0,15"/>
                                        <Button x:Name="EmptyStateAddButton"
                                                Content="Add Training Records"
                                                Style="{StaticResource ActionButton}"
                                                Click="AddTraining_Click"
                                                HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <!-- Training Action Buttons -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                <Button Content="Add Training" 
                                        Style="{StaticResource ActionButton}"
                                        Click="AddTraining_Click"
                                        Visibility="Collapsed"/>
                                <Button x:Name="CompleteTrainingButton"
                                        Content="Complete Training" 
                                        Style="{StaticResource ExportButton}"
                                        Click="CompleteTraining_Click"/>
                                <Button Content="Export Training Records" 
                                        Style="{StaticResource ExportButton}"
                                        Click="ExportTraining_Click"/>
                                <Button Content="View Training Graph" 
                                        Style="{StaticResource ActionButton}"
                                        Click="ViewChart"
                                        Visibility="Collapsed"/>
                            </StackPanel>

                            <!-- Add Training Form -->
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Border x:Name="AddTrainingPanel"
                                        BorderBrush="#BDC3C7" 
                                        BorderThickness="1" 
                                        Padding="20" 
                                        Background="#F8F9FA"
                                        CornerRadius="5"
                                        Visibility="Visible">
                                    <StackPanel Visibility="Visible">
                                        <TextBlock Text="Add New Training Record" 
                                                   FontSize="16" 
                                                   FontWeight="Bold" 
                                                   Foreground="#2C3E50"
                                                   Margin="0,0,0,15"/>

                                        <TextBlock Text="Employee *" FontSize="12" Margin="0,0,0,3"/>
                                        <ComboBox x:Name="TrainingEmployeeComboBox" 
                                                    Style="{StaticResource ModernComboBox}" 
                                                    DisplayMemberPath="FullName"
                                                    SelectedValuePath="Id"
                                                    IsEditable="True"
                                                    IsTextSearchEnabled="True"
                                                    Margin="0,0,0,10"/>

                                        <TextBlock Text="Training Type *" FontSize="12" Margin="0,0,0,3"/>
                                        <ComboBox x:Name="TrainingTypeComboBox" 
                                                    Style="{StaticResource ModernComboBox}" 
                                                    Margin="0,0,0,10">
                                            <ComboBoxItem Content="Ethics Training"/>
                                            <ComboBoxItem Content="Induction"/>
                                            <ComboBoxItem Content="Health and Safety"/>
                                            <ComboBoxItem Content="Fire Safety"/>
                                            <ComboBoxItem Content="First Aid"/>
                                            <ComboBoxItem Content="Data Privacy"/>
                                            <ComboBoxItem Content="Workplace Harassment"/>
                                            <ComboBoxItem Content="Other"/>
                                        </ComboBox>

                                        <TextBlock Text="Notes" FontSize="12" Margin="0,0,0,3"/>
                                        <TextBox x:Name="TrainingNotesTextBox" 
                                                    Style="{StaticResource ModernTextBox}" 
                                                    Height="60"
                                                    TextWrapping="Wrap"
                                                    AcceptsReturn="True"
                                                    Margin="0,0,0,15"/>

                                        <StackPanel Orientation="Horizontal">
                                            <Button Content="Save Training" 
                                                    Style="{StaticResource ActionButton}"
                                                    Click="SaveTraining_Click"/>
                                            <Button Content="Cancel" 
                                                    Style="{StaticResource ToggleButton}"
                                                    Click="CancelAddTraining_Click"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>

                                <!-- Training Statistics Pie Chart (Bottom Right) -->
                                <Border x:Name="TrainingStatsBorder"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left"
                                        Margin="27,0,0,0"
                                        Background="White"
                                        BorderBrush="#BDC3C7"
                                        BorderThickness="1"
                                        CornerRadius="5"
                                        Padding="20"
                                        Width="400"
                                        Height="400" Grid.Column="1">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Title -->
                                        <TextBlock Grid.Row="0"
                                                    Text="Training Status Overview"
                                                    FontSize="16"
                                                    FontWeight="Bold"
                                                    Foreground="#2C3E50"
                                                    HorizontalAlignment="Center"
                                                    Margin="0,0,0,15"/>


                                        <!-- Pie Chart Canvas -->
                                        <Canvas x:Name="PieChartCanvas"
                                                Grid.Row="1"
                                                Width="260"
                                                Height="260"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"/>

                                        <!-- Legend -->
                                        <StackPanel Grid.Row="2" 
                                       Margin="0,15,0,0"
                                       HorizontalAlignment="Center">
                                            <StackPanel Orientation="Horizontal" Margin="0,3">
                                                <Border Background="#27AE60" Width="16" Height="16" CornerRadius="3" Margin="0,0,8,0"/>
                                                <TextBlock x:Name="CompletedLegend" Text="Completed: 0 (0%)" FontSize="13" FontWeight="SemiBold" Foreground="#2C3E50"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,3">
                                                <Border Background="#F39C12" Width="16" Height="16" CornerRadius="3" Margin="0,0,8,0"/>
                                                <TextBlock x:Name="PendingLegend" Text="In Progress: 0 (0%)" FontSize="13" FontWeight="SemiBold" Foreground="#2C3E50"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,3">
                                                <Border Background="#E74C3C" Width="16" Height="16" CornerRadius="3" Margin="0,0,8,0"/>
                                                <TextBlock x:Name="NotCompletedLegend" Text="Not Started: 0 (0%)" FontSize="13" FontWeight="SemiBold" Foreground="#2C3E50"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </Grid>


                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</Page>